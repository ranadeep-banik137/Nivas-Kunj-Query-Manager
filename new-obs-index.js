let mode='login';const status=document['getElementById']('status');function toggleMode(j){mode=j;const q=document['getElementById']('main-title'),A=document['getElementById']('mainBtn'),T=document['getElementById']('toggle-btn'),I=document['getElementById']('confirm-group'),h=document['getElementById']('password-group'),X=document['getElementById']('email-group');status['innerText']='';if(mode==='register')q['innerText']='Join\x20Us',A['innerText']='Create\x20Account',T['innerText']='Back\x20to\x20Login',T['onclick']=()=>toggleMode('login'),I['classList']['add']('hidden');else{if(mode==='reset')q['innerText']='Recover',A['innerText']='Send\x20Reset\x20Link',h['classList']['add']('hidden'),T['innerText']='Back\x20to\x20Login',T['onclick']=()=>toggleMode('login');else mode==='update'?(q['innerText']='Update\x20Key',A['innerText']='Set\x20New\x20Password',X['classList']['add']('hidden'),I['classList']['remove']('hidden'),T['classList']['add']('hidden')):(q['innerText']='Authorize',A['innerText']='Enter\x20Workspace',T['innerText']='New\x20Member?',T['onclick']=()=>toggleMode('register'),h['classList']['remove']('hidden'),X['classList']['remove']('hidden'),I['classList']['add']('hidden'),T['classList']['remove']('hidden'));}}document['getElementById']('mainBtn')['onclick']=async()=>{const {data:{session:j}}=await sb['auth']['getSession']();if(j){window['location']['href']='portal.html';return;}const q=document['getElementById']('email')['value'],A=document['getElementById']('password')['value'],T=document['getElementById']('confirm-password')['value'];status['innerText']='Processing...';if(mode==='update'){if(A!==T){status['innerText']='❌\x20Keys\x20do\x20not\x20match';return;}const {error:I}=await sb['auth']['updateUser']({'password':A});if(I)status['innerText']='❌\x20'+I['message'];else status['innerText']='✅\x20Success!',setTimeout(()=>toggleMode('login'),0x7d0);}else{if(mode==='reset'){const {error:h}=await sb['auth']['resetPasswordForEmail'](q,{'redirectTo':window['location']['origin']+'/index.html'});status['innerText']=h?'❌\x20'+h['message']:'✅\x20Link\x20Sent!';}else{if(mode==='register'){const {error:X}=await sb['auth']['signUp']({'email':q,'password':A});if(X)status['innerText']='❌\x20'+X['message'];else status['innerText']='✅\x20Account\x20Created!',setTimeout(()=>toggleMode('login'),0x7d0);}else{const c=await sb['auth']['signInWithPassword']({'email':q,'password':A});c['error']?status['innerText']='❌\x20Login\x20Failed':(await createServerSession(c['data']['user']['id']),console['log']('Server\x20session\x20established.'),window['location']['href']='portal.html');}}}},document['getElementById']('magicBtn')['onclick']=async()=>{const j=document['getElementById']('email')['value'];if(!j){status['innerText']='❌\x20Email\x20required';return;}const {error:q}=await sb['auth']['signInWithOtp']({'email':j,'options':{'emailRedirectTo':window['location']['origin']+'/portal.html'}});status['innerText']=q?'❌\x20'+q['message']:'✅\x20Check\x20Inbox!';},document['getElementById']('googleBtn')['onclick']=async()=>{await sb['auth']['signInWithOAuth']({'provider':'google','options':{'redirectTo':window['location']['origin']+'/portal.html'}});},window['addEventListener']('storage',j=>{j['key']&&j['key']['includes']('supabase.auth.token')&&j['newValue']&&(console['log']('Session\x20detected\x20from\x20another\x20tab.\x20Redirecting...'),window['location']['href']='portal.html');}),window['onload']=async()=>{const {data:{session:j},error:q}=await sb['auth']['getSession']();if(j&&j['user']){console['log']('Active\x20session\x20detected,\x20redirecting...'),window['location']['href']='portal.html';return;}if(window['location']['hash']['includes']('type=recovery'))toggleMode('update');},window['addEventListener']('DOMContentLoaded',()=>{const j=new URLSearchParams(window['location']['search']),q=j['get']('email'),A=j['get']('mode');q&&document['getElementById']('email')&&(document['getElementById']('email')['value']=q),A==='register'&&(typeof toggleMode==='function'&&toggleMode('register'));});async function createServerSession(j){const q=0x2,A=new Date();A['setHours'](A['getHours']()+q);const T=await sb['from']('user_sessions')['upsert']({'user_id':j,'expires_at':A['toISOString']()},{'onConflict':'user_id'});if(T['error'])console['error']('Session\x20tracking\x20failed:',error);}